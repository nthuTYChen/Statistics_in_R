source("https://raw.githubusercontent.com/nthuTYChen/Statistics_in_R/main/courseUtil.R")
sl.sim = loadCourseCSV(2025, "5_ANOVA", "SaitoLysterSim.csv")
# Use the y ~ x syntax (explain the dependent variable y with the independent
# variable/factor x) to build an ANOVA model and fit the model to the data
sl.sim.aov = aov(formula = rF3 ~ Group, data = sl.sim)
# Get the analysis summary
summary(sl.sim.aov)
# Validate the F-value: between-sample Mean Sq / within-sample Mean Sq (aka MSE)
5345500 / 107131
# Manually calculate SS, F, and p-value in one-way independent-measures ANOVA
# The global mean: The average value of the entire sample
mean.grand = mean(sl.sim$rF3)
# Calculate the three sample means
mean.control = mean(sl.sim[sl.sim$Group == "Control",]$rF3)
mean.ffi = mean(sl.sim[sl.sim$Group == "FFI",]$rF3)
mean.fficf = mean(sl.sim[sl.sim$Group == "FFI+CF",]$rF3)
# Get the three sample sizes
control.n = nrow(subset(sl.sim, Group == "Control"))
ffi.n = nrow(subset(sl.sim, Group == "FFI"))
fficf.n = nrow(subset(sl.sim, Group == "FFI+CF"))
# Calculate the between-samples sum of squares (SS-between): The squared differences
# between individual sample means and the global mean
ss.between = control.n * (mean.control - mean.grand) ^ 2 +
ffi.n * (mean.ffi - mean.grand) ^ 2 +
fficf.n * (mean.fficf - mean.grand) ^ 2
ss.between
# df-between is the number of levels in the only fixed factor (aka independent
# variable) minus 1
# Between-sample mean squared difference, or MS. The interesting variance.
ss.between / (3 - 1)
# Calculate the within-sample sum of squares (SS-within): The squared differences
# between individual data points in each sample and their sample mean.
ss.control = sum((sl.sim[sl.sim$Group == "Control",]$rF3 - mean.control) ^ 2)
ss.ffi = sum((sl.sim[sl.sim$Group == "FFI",]$rF3 - mean.ffi) ^ 2)
ss.fficf = sum((sl.sim[sl.sim$Group == "FFI+CF",]$rF3 - mean.fficf) ^ 2)
ss.within = sum(ss.control, ss.ffi, ss.fficf)
ss.within
pf(q = 49.9, df1 = 2, df2 = 637, lower.tail = F) * 2
